# ЭТАП 1: API И ИНТЕРФЕЙСЫ

**Версия:** 1.0  
**Дата:** 2025  
**Статус:** Проектирование

---

## Оглавление

1. [REST API Спецификация](#rest-api-спецификация)
2. [Описание веб-интерфейсов](#описание-веб-интерфейсов)
3. [Мобильное приложение](#мобильное-приложение)
4. [Интеграционные интерфейсы](#интеграционные-интерфейсы)

---

## REST API Спецификация

### Базовый URL

```
https://api.alarm-analysis.tatneft.local/v1
```

### Аутентификация

Используется JWT токен в заголовке:

```
Authorization: Bearer <token>
```

### Общие форматы ответов

#### Успешный ответ

```json
{
  "success": true,
  "data": { ... },
  "meta": {
    "timestamp": "2025-08-15T10:30:00Z",
    "request_id": "uuid"
  }
}
```

#### Ошибка

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "Описание ошибки",
    "details": { ... }
  },
  "meta": {
    "timestamp": "2025-08-15T10:30:00Z",
    "request_id": "uuid"
  }
}
```

### Endpoints

#### 1. Аварийные сигналы

##### GET /alarms

Получение списка аварийных сигналов

**Query параметры:**
- `ngdu_id` (string, optional) - Фильтр по НГДУ
- `object_id` (string, optional) - Фильтр по объекту
- `status` (string, optional) - Фильтр по статусу: `active`, `resolved`, `false_alarm`
- `date_from` (date, optional) - Начало периода
- `date_to` (date, optional) - Конец периода
- `limit` (integer, default: 100) - Количество записей
- `offset` (integer, default: 0) - Смещение

**Ответ:**
```json
{
  "success": true,
  "data": {
    "alarms": [
      {
        "id": "uuid",
        "parameter_id": "uuid",
        "parameter_name": "Давление на приёме Н-1",
        "object_id": "uuid",
        "object_name": "ДНС-123",
        "ngdu_id": "uuid",
        "ngdu_name": "НГДУ-1",
        "alarm_type": "low",
        "alarm_message": "Низкое давление на приёме Н-1",
        "triggered_at": "2025-08-15T08:30:00Z",
        "resolved_at": null,
        "status": "active",
        "classification": "real"
      }
    ],
    "total": 150,
    "limit": 100,
    "offset": 0
  }
}
```

##### GET /alarms/{id}

Получение детальной информации об аварийном сигнале

**Ответ:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "parameter_id": "uuid",
    "parameter_name": "Давление на приёме Н-1",
    "object_id": "uuid",
    "object_name": "ДНС-123",
    "ngdu_id": "uuid",
    "ngdu_name": "НГДУ-1",
    "alarm_type": "low",
    "alarm_message": "Низкое давление на приёме Н-1",
    "triggered_at": "2025-08-15T08:30:00Z",
    "resolved_at": null,
    "status": "active",
    "classification": "real",
    "cause": "При работе насоса давление на приеме падает с 0,08 МПа до 0,01 МПа",
    "analysis": {
      "trend_analysis_id": "uuid",
      "threshold_validation_id": "uuid",
      "equipment_status": "operational"
    }
  }
}
```

##### POST /alarms/{id}/classify

Классификация аварийного сигнала (ручная или автоматическая)

**Тело запроса:**
```json
{
  "classification": "false_alarm",
  "reason": "Оборудование выведено из эксплуатации",
  "comment": "Емкость не в эксплуатации"
}
```

#### 2. Анализ объектов

##### POST /objects/{id}/analyze

Запуск анализа объекта

**Тело запроса:**
```json
{
  "period_start": "2025-07-01",
  "period_end": "2025-08-31",
  "parameters": ["pressure", "level"],  // optional, если не указано - анализируются все
  "force": false  // Принудительный пересчет, даже если анализ уже выполнен
}
```

**Ответ:**
```json
{
  "success": true,
  "data": {
    "analysis_id": "uuid",
    "object_id": "uuid",
    "status": "in_progress",
    "started_at": "2025-08-15T10:30:00Z",
    "estimated_completion": "2025-08-15T10:35:00Z"
  }
}
```

##### GET /objects/{id}/analysis/{analysis_id}

Получение результатов анализа

**Ответ:**
```json
{
  "success": true,
  "data": {
    "analysis_id": "uuid",
    "object_id": "uuid",
    "object_name": "ДНС-123",
    "status": "completed",
    "started_at": "2025-08-15T10:30:00Z",
    "completed_at": "2025-08-15T10:32:00Z",
    "parameters": [
      {
        "parameter_id": "uuid",
        "parameter_name": "Давление на приёме Н-1",
        "parameter_type": "pressure",
        "trend_analysis": {
          "current_month_stats": {
            "avg": 0.34,
            "min": 0.30,
            "max": 0.42,
            "median": 0.34,
            "std_dev": 0.02
          },
          "previous_month_stats": {
            "avg": 0.33,
            "min": 0.28,
            "max": 0.40,
            "median": 0.33,
            "std_dev": 0.02
          },
          "comparison": {
            "change_percent": 3.0,
            "trend": "stable"
          }
        },
        "threshold_validation": {
          "status": "non_compliant",
          "issues": [
            {
              "type": "threshold_below_actual_max",
              "threshold_type": "max",
              "threshold_value": 0.40,
              "actual_max": 0.42,
              "severity": "high"
            }
          ],
          "recommendations": [
            {
              "type": "increase_max_threshold",
              "current_value": 0.40,
              "recommended_value": 0.46,
              "justification": "Фактическое максимальное значение 0.42 МПа, уставка 0.40 МПа ниже фактического"
            }
          ]
        },
        "equipment_status": {
          "status": "operational",
          "reason": "normal_operation"
        }
      }
    ],
    "recommendations": [
      {
        "id": "uuid",
        "type": "change_threshold",
        "title": "Изменить уставку Давление на приёме Н-1",
        "description": "Рекомендуется увеличить уставку Давление на приёме Н-1 с 0.40 МПа до 0.46 МПа",
        "justification": "Фактическое максимальное значение 0.42 МПа, уставка 0.40 МПа ниже фактического",
        "priority": "high",
        "status": "new"
      }
    ]
  }
}
```

##### GET /objects/{id}/trends

Получение трендов параметров объекта

**Query параметры:**
- `parameter_id` (string, optional) - Фильтр по параметру
- `period_start` (date, required) - Начало периода
- `period_end` (date, required) - Конец периода
- `interval` (string, default: "1h") - Интервал агрегации: `1m`, `5m`, `15m`, `1h`, `1d`

**Ответ:**
```json
{
  "success": true,
  "data": {
    "parameter_id": "uuid",
    "parameter_name": "Давление на приёме Н-1",
    "period_start": "2025-07-01",
    "period_end": "2025-08-31",
    "interval": "1h",
    "data": [
      {
        "time": "2025-08-15T00:00:00Z",
        "value": 0.34,
        "quality": 100
      },
      {
        "time": "2025-08-15T01:00:00Z",
        "value": 0.35,
        "quality": 100
      }
    ],
    "statistics": {
      "avg": 0.34,
      "min": 0.30,
      "max": 0.42,
      "median": 0.34,
      "std_dev": 0.02
    }
  }
}
```

#### 3. Уставки

##### GET /thresholds

Получение списка уставок

**Query параметры:**
- `object_id` (string, optional) - Фильтр по объекту
- `parameter_id` (string, optional) - Фильтр по параметру
- `status` (string, optional) - Фильтр по статусу: `active`, `pending`, `expired`

**Ответ:**
```json
{
  "success": true,
  "data": {
    "thresholds": [
      {
        "id": "uuid",
        "parameter_id": "uuid",
        "parameter_name": "Давление на приёме Н-1",
        "object_id": "uuid",
        "object_name": "ДНС-123",
        "threshold_type": "max",
        "value": 0.40,
        "unit": "МПа",
        "source": "СЭД",
        "document_reference": "согл-1338054496-3",
        "effective_date": "2025-01-01",
        "expiration_date": null,
        "status": "active",
        "validation": {
          "status": "non_compliant",
          "actual_max": 0.42,
          "recommended_value": 0.46
        }
      }
    ]
  }
}
```

##### GET /thresholds/{id}

Получение детальной информации об уставке

##### PUT /thresholds/{id}

Обновление уставки

**Тело запроса:**
```json
{
  "value": 0.46,
  "effective_date": "2025-08-20",
  "source": "manual",
  "comment": "Применена рекомендация системы"
}
```

##### POST /thresholds/{id}/validate

Проверка соответствия уставки

**Ответ:**
```json
{
  "success": true,
  "data": {
    "threshold_id": "uuid",
    "validation_date": "2025-08-15",
    "status": "non_compliant",
    "issues": [
      {
        "type": "threshold_below_actual_max",
        "threshold_type": "max",
        "threshold_value": 0.40,
        "actual_max": 0.42,
        "deviation": 0.02,
        "severity": "high"
      }
    ],
    "recommendations": [
      {
        "type": "increase_max_threshold",
        "current_value": 0.40,
        "recommended_value": 0.46,
        "justification": "Фактическое максимальное значение 0.42 МПа, уставка 0.40 МПа ниже фактического"
      }
    ]
  }
}
```

#### 4. Рекомендации

##### GET /recommendations

Получение списка рекомендаций

**Query параметры:**
- `object_id` (string, optional) - Фильтр по объекту
- `type` (string, optional) - Фильтр по типу
- `status` (string, optional) - Фильтр по статусу: `new`, `accepted`, `in_progress`, `completed`, `rejected`
- `priority` (string, optional) - Фильтр по приоритету: `high`, `medium`, `low`
- `assignee_role` (string, optional) - Фильтр по роли адресата
- `limit` (integer, default: 100)
- `offset` (integer, default: 0)

**Ответ:**
```json
{
  "success": true,
  "data": {
    "recommendations": [
      {
        "id": "uuid",
        "type": "change_threshold",
        "title": "Изменить уставку Давление на приёме Н-1",
        "description": "Рекомендуется увеличить уставку Давление на приёме Н-1 с 0.40 МПа до 0.46 МПа",
        "justification": "Фактическое максимальное значение 0.42 МПа, уставка 0.40 МПа ниже фактического",
        "object_id": "uuid",
        "object_name": "ДНС-123",
        "parameter_id": "uuid",
        "parameter_name": "Давление на приёме Н-1",
        "current_value": 0.40,
        "recommended_value": 0.46,
        "priority": "high",
        "status": "new",
        "assignee_role": "ЦДНГ",
        "created_at": "2025-08-15T10:30:00Z",
        "updated_at": "2025-08-15T10:30:00Z"
      }
    ],
    "total": 50,
    "limit": 100,
    "offset": 0
  }
}
```

##### GET /recommendations/{id}

Получение детальной информации о рекомендации

**Ответ:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "type": "change_threshold",
    "title": "Изменить уставку Давление на приёме Н-1",
    "description": "Рекомендуется увеличить уставку Давление на приёме Н-1 с 0.40 МПа до 0.46 МПа",
    "justification": "Фактическое максимальное значение 0.42 МПа, уставка 0.40 МПа ниже фактического",
    "object_id": "uuid",
    "object_name": "ДНС-123",
    "parameter_id": "uuid",
    "parameter_name": "Давление на приёме Н-1",
    "current_value": 0.40,
    "recommended_value": 0.46,
    "priority": "high",
    "status": "new",
    "assignee_role": "ЦДНГ",
    "assignee_id": null,
    "created_at": "2025-08-15T10:30:00Z",
    "updated_at": "2025-08-15T10:30:00Z",
    "history": [
      {
        "id": "uuid",
        "action": "created",
        "user_id": "uuid",
        "user_name": "Система",
        "comment": null,
        "created_at": "2025-08-15T10:30:00Z"
      }
    ],
    "related_analysis": {
      "analysis_id": "uuid",
      "trend_analysis_id": "uuid",
      "threshold_validation_id": "uuid"
    }
  }
}
```

##### POST /recommendations/{id}/accept

Принятие рекомендации

**Тело запроса:**
```json
{
  "comment": "Принято к исполнению",
  "assignee_id": "uuid",  // optional
  "planned_completion_date": "2025-08-20"  // optional
}
```

##### POST /recommendations/{id}/reject

Отклонение рекомендации

**Тело запроса:**
```json
{
  "comment": "Не требуется, уставка соответствует нормам",
  "reason": "manual_review"
}
```

##### POST /recommendations/{id}/complete

Завершение рекомендации

**Тело запроса:**
```json
{
  "comment": "Уставка изменена в АСУТП",
  "actual_value": 0.46,
  "completion_date": "2025-08-18"
}
```

#### 5. Объекты

##### GET /objects

Получение списка объектов

**Query параметры:**
- `ngdu_id` (string, optional) - Фильтр по НГДУ
- `object_type` (string, optional) - Фильтр по типу: `ДНС`, `ГЗНУ`, `УПСВ`, `ГЗУ`, `БГ`, `Скважина`
- `status` (string, optional) - Фильтр по статусу: `active`, `inactive`, `decommissioned`

**Ответ:**
```json
{
  "success": true,
  "data": {
    "objects": [
      {
        "id": "uuid",
        "name": "ДНС-123",
        "code": "DNS-123",
        "ngdu_id": "uuid",
        "ngdu_name": "НГДУ-1",
        "object_type": "ДНС",
        "location": "Площадка 5",
        "status": "active",
        "alarms_count": {
          "today": 5,
          "week": 45,
          "month": 180
        },
        "recommendations_count": {
          "new": 2,
          "in_progress": 1
        }
      }
    ]
  }
}
```

##### GET /objects/{id}

Получение детальной информации об объекте

**Ответ:**
```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "name": "ДНС-123",
    "code": "DNS-123",
    "ngdu_id": "uuid",
    "ngdu_name": "НГДУ-1",
    "object_type": "ДНС",
    "location": "Площадка 5",
    "status": "active",
    "equipment": [
      {
        "id": "uuid",
        "name": "Насос Н-1",
        "equipment_type": "насос",
        "model": "ЦНС-60-250",
        "manufacturer": "ООО Завод",
        "status": "operational"
      },
      {
        "id": "uuid",
        "name": "Емкость Е-1",
        "equipment_type": "емкость",
        "status": "operational"
      }
    ],
    "parameters": [
      {
        "id": "uuid",
        "name": "Давление на приёме Н-1",
        "type": "pressure",
        "unit": "МПа",
        "equipment_id": "uuid",
        "equipment_name": "Насос Н-1"
      }
    ],
    "last_analysis": {
      "analysis_id": "uuid",
      "completed_at": "2025-08-15T08:00:00Z",
      "status": "completed"
    }
  }
}
```

#### 6. Отчеты

##### POST /reports/generate

Генерация отчета

**Тело запроса:**
```json
{
  "report_type": "daily",  // daily, weekly, monthly, object, recommendations
  "period_start": "2025-08-14",
  "period_end": "2025-08-15",
  "ngdu_id": "uuid",  // optional
  "object_id": "uuid",  // optional
  "format": "pdf"  // pdf, excel, word
}
```

**Ответ:**
```json
{
  "success": true,
  "data": {
    "report_id": "uuid",
    "status": "generating",
    "estimated_completion": "2025-08-15T10:35:00Z"
  }
}
```

##### GET /reports/{id}

Получение статуса и результата генерации отчета

**Ответ:**
```json
{
  "success": true,
  "data": {
    "report_id": "uuid",
    "status": "completed",
    "format": "pdf",
    "file_url": "https://api.alarm-analysis.tatneft.local/v1/reports/uuid/download",
    "file_size": 2048576,
    "generated_at": "2025-08-15T10:32:00Z"
  }
}
```

##### GET /reports/{id}/download

Скачивание отчета

#### 7. Дашборд

##### GET /dashboard/stats

Получение статистики для дашборда

**Query параметры:**
- `ngdu_id` (string, optional) - Фильтр по НГДУ
- `period_start` (date, optional) - Начало периода (по умолчанию: сегодня - 7 дней)
- `period_end` (date, optional) - Конец периода (по умолчанию: сегодня)

**Ответ:**
```json
{
  "success": true,
  "data": {
    "alarms": {
      "total": 150,
      "active": 25,
      "resolved": 120,
      "false_alarms": 5,
      "by_type": {
        "pressure": 80,
        "level": 40,
        "gas": 20,
        "other": 10
      },
      "by_ngdu": [
        {
          "ngdu_id": "uuid",
          "ngdu_name": "НГДУ-1",
          "count": 50
        }
      ],
      "trend": {
        "current_period": 150,
        "previous_period": 180,
        "change_percent": -16.7
      }
    },
    "recommendations": {
      "total": 45,
      "new": 15,
      "in_progress": 20,
      "completed": 8,
      "rejected": 2,
      "by_priority": {
        "high": 10,
        "medium": 25,
        "low": 10
      }
    },
    "top_objects": [
      {
        "object_id": "uuid",
        "object_name": "ДНС-123",
        "alarms_count": 25,
        "recommendations_count": 3
      }
    ]
  }
}
```

#### 8. Уведомления

##### GET /notifications

Получение списка уведомлений пользователя

**Query параметры:**
- `unread_only` (boolean, default: false) - Только непрочитанные
- `limit` (integer, default: 50)
- `offset` (integer, default: 0)

##### POST /notifications/{id}/read

Отметить уведомление как прочитанное

---

## Описание веб-интерфейсов

### 1. Дашборд диспетчера ЕДС

#### Структура страницы

```
┌─────────────────────────────────────────────────────────────┐
│  Заголовок: Анализ аварийных сигналов                       │
│  [Фильтры: НГДУ ▼] [Период: 14.08 - 15.08] [Обновить]     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐    │
│  │ Всего тревог │  │ Активных     │  │ Рекомендаций │    │
│  │    150       │  │    25        │  │     45       │    │
│  │  ↓ 16.7%     │  │  ↓ 10%       │  │  ↑ 5 новых   │    │
│  └──────────────┘  └──────────────┘  └──────────────┘    │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ График количества тревог по дням                     │  │
│  │ [Линейный график: дни по оси X, количество по Y]    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────┐  ┌──────────────────────────┐  │
│  │ Распределение по     │  │ Топ проблемных объектов   │  │
│  │ типам объектов       │  │                          │  │
│  │ [Круговая диаграмма] │  │ 1. ДНС-123 - 25 тревог   │  │
│  │                      │  │ 2. ДНС-124 - 20 тревог   │  │
│  │                      │  │ 3. ГЗНУ-45 - 15 тревог   │  │
│  └──────────────────────┘  └──────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Текущие активные тревоги                             │  │
│  │ [Таблица с фильтрами и сортировкой]                  │  │
│  │ Время | Объект | Параметр | Тип | Действия          │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### Компоненты

1. **Карточки статистики:**
   - Всего тревог за период
   - Активных тревог
   - Новых рекомендаций
   - Сравнение с предыдущим периодом (стрелки вверх/вниз)

2. **График количества тревог:**
   - Линейный график по дням
   - Возможность выбора периода
   - Сравнение с предыдущим периодом (две линии)

3. **Распределение по типам объектов:**
   - Круговая диаграмма
   - Клик по сектору - фильтрация

4. **Топ проблемных объектов:**
   - Таблица объектов с наибольшим количеством тревог
   - Клик по объекту - переход к детальному анализу

5. **Таблица текущих тревог:**
   - Фильтры: по НГДУ, по типу, по статусу
   - Сортировка: по времени, по количеству
   - Цветовая индикация приоритета
   - Действия: просмотр деталей, запуск анализа

### 2. Интерфейс анализа объекта

#### Структура страницы

```
┌─────────────────────────────────────────────────────────────┐
│  [← Назад] ДНС-123 (НГДУ-1)                    [Запустить анализ] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Информация об объекте                                 │  │
│  │ Тип: ДНС | Статус: В работе | Последний анализ: сегодня │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Параметры: [Все ▼] [Давление] [Уровень] [Температура]│  │
│  │                                                       │  │
│  │ ┌─────────────────────────────────────────────────┐  │  │
│  │ │ Давление на приёме Н-1                         │  │  │
│  │ │ [График: время по X, давление по Y]           │  │  │
│  │ │ [Линия уставок на графике]                     │  │  │
│  │ │ [Отметки моментов сработок]                    │  │  │
│  │ │                                                 │  │  │
│  │ │ Статистика:                                     │  │  │
│  │ │ Среднее: 0.34 МПа | Мин: 0.30 | Макс: 0.42    │  │  │
│  │ │ Изменение: +3% к предыдущему месяцу            │  │  │
│  │ └─────────────────────────────────────────────────┘  │  │
│  │                                                       │  │
│  │ [Аналогичные блоки для других параметров]            │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Результаты анализа                                   │  │
│  │                                                       │  │
│  │ ✓ Анализ трендов выполнен                            │  │
│  │ ⚠ Проверка уставок: найдены несоответствия          │  │
│  │ ✓ Состояние оборудования: в работе                    │  │
│  │                                                       │  │
│  │ Проблемы:                                            │  │
│  │ • Уставка максимального давления (0.40 МПа) ниже    │  │
│  │   фактического максимального значения (0.42 МПа)      │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Рекомендации (2)                                     │  │
│  │                                                       │  │
│  │ [Карточка рекомендации 1]                            │  │
│  │ [Карточка рекомендации 2]                            │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### Компоненты

1. **Информация об объекте:**
   - Название, тип, НГДУ
   - Статус
   - Дата последнего анализа

2. **Графики параметров:**
   - Интерактивные графики (Chart.js или Recharts)
   - Масштабирование, панорамирование
   - Отображение уставок
   - Отметки моментов сработок
   - Сравнение с предыдущим периодом

3. **Статистика:**
   - Средние, минимальные, максимальные значения
   - Сравнение с предыдущим периодом
   - Тренды

4. **Результаты анализа:**
   - Статус выполнения каждого этапа анализа
   - Выявленные проблемы
   - Детальная информация

5. **Рекомендации:**
   - Карточки рекомендаций
   - Действия: принять, отклонить, просмотреть детали

### 3. Интерфейс управления уставками

#### Структура страницы

```
┌─────────────────────────────────────────────────────────────┐
│  Управление уставками                    [Экспорт] [Импорт] │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [Фильтры: НГДУ ▼] [Объект ▼] [Параметр ▼] [Статус ▼]     │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Таблица уставок                                     │  │
│  │                                                       │  │
│  │ Объект | Параметр | Текущая | Рекомендуемая | Статус│  │
│  │ ДНС-123| Давление | 0.40 МПа| 0.46 МПа      | ⚠    │  │
│  │        | на приёме|         |               |       │  │
│  │        | Н-1      |         |               |       │  │
│  │ ДНС-123| Давление | 1.4 МПа | 1.2 МПа       | ⚠    │  │
│  │        | на выкиде|         |               |       │  │
│  │        | Н-1      |         |               |       │  │
│  │                                                       │  │
│  │ [Выбрать все] [Применить рекомендации] [Экспорт]    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  При выборе строки открывается детальная панель справа:    │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Детали уставки                                        │  │
│  │                                                       │  │
│  │ Параметр: Давление на приёме Н-1                     │  │
│  │ Объект: ДНС-123                                      │  │
│  │                                                       │  │
│  │ Текущие уставки:                                     │  │
│  │ • Минимальная: 0.05 МПа                              │  │
│  │ • Максимальная: 0.40 МПа ⚠                           │  │
│  │ • Аварийная мин: 0.03 МПа                            │  │
│  │ • Аварийная макс: 0.45 МПа                            │  │
│  │                                                       │  │
│  │ Фактические параметры:                               │  │
│  │ • Среднее: 0.34 МПа                                   │  │
│  │ • Минимум: 0.30 МПа                                   │  │
│  │ • Максимум: 0.42 МПа                                  │  │
│  │                                                       │  │
│  │ Рекомендуемые уставки:                                │  │
│  │ • Максимальная: 0.46 МПа                              │  │
│  │                                                       │  │
│  │ Обоснование:                                          │  │
│  │ Фактическое максимальное значение 0.42 МПа,          │  │
│  │ уставка 0.40 МПа ниже фактического.                   │  │
│  │                                                       │  │
│  │ [Применить рекомендацию] [Отклонить] [История]       │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

### 4. Интерфейс рекомендаций

#### Структура страницы

```
┌─────────────────────────────────────────────────────────────┐
│  Рекомендации                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [Фильтры: Тип ▼] [Приоритет ▼] [Статус ▼] [Адресат ▼]    │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ Список рекомендаций                                  │  │
│  │                                                       │  │
│  │ ┌─────────────────────────────────────────────────┐  │  │
│  │ │ 🔴 Высокий приоритет                            │  │  │
│  │ │ Изменить уставку Давление на приёме Н-1        │  │  │
│  │ │                                                 │  │  │
│  │ │ Объект: ДНС-123 | Параметр: Давление на приёме  │  │  │
│  │ │                                                 │  │  │
│  │ │ Рекомендуется увеличить уставку с 0.40 МПа до  │  │  │
│  │ │ 0.46 МПа                                        │  │  │
│  │ │                                                 │  │  │
│  │ │ Обоснование: Фактическое максимальное значение│  │  │
│  │ │ 0.42 МПа, уставка 0.40 МПа ниже фактического   │  │  │
│  │ │                                                 │  │  │
│  │ │ Адресат: ЦДНГ | Статус: Новая                  │  │  │
│  │ │                                                 │  │  │
│  │ │ [Принять] [Отклонить] [Просмотр]                │  │  │
│  │ └─────────────────────────────────────────────────┘  │  │
│  │                                                       │  │
│  │ [Аналогичные карточки для других рекомендаций]       │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## Мобильное приложение

### Основные экраны

1. **Главный экран (Dashboard):**
   - Краткая статистика
   - Активные тревоги
   - Новые рекомендации

2. **Список тревог:**
   - Фильтры
   - Детали тревоги

3. **Список рекомендаций:**
   - Уведомления о новых рекомендациях
   - Быстрые действия

4. **Детали объекта:**
   - Основная информация
   - Графики (упрощенные)

### Push-уведомления

- Новые критические тревоги
- Новые рекомендации высокого приоритета
- Завершение анализа объекта

---

## Интеграционные интерфейсы

### 1. WebSocket для реального времени

**Endpoint:** `wss://api.alarm-analysis.tatneft.local/v1/ws`

**События:**

```json
{
  "type": "alarm_triggered",
  "data": {
    "alarm_id": "uuid",
    "object_name": "ДНС-123",
    "alarm_message": "Низкое давление на приёме Н-1",
    "triggered_at": "2025-08-15T10:30:00Z"
  }
}
```

```json
{
  "type": "analysis_completed",
  "data": {
    "analysis_id": "uuid",
    "object_id": "uuid",
    "object_name": "ДНС-123",
    "status": "completed"
  }
}
```

### 2. Webhook для внешних систем

**Endpoint:** `POST /webhooks/{webhook_id}`

**События:**
- `alarm.triggered` - Новая тревога
- `recommendation.created` - Новая рекомендация
- `analysis.completed` - Завершен анализ

---

## Заключение

Данный документ описывает API и интерфейсы системы анализа аварийных сигналов. Все интерфейсы спроектированы с учетом:

1. **Удобства использования** - интуитивные интерфейсы для различных ролей
2. **Производительности** - оптимизированные запросы и кэширование
3. **Масштабируемости** - поддержка большого количества объектов и данных
4. **Интеграции** - возможность интеграции с существующими системами

